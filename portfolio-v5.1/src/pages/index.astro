---
import Base from "../layouts/Base.astro";
import BackgroundStatic from "../components/BackgroundStatic.astro";
import Icon from "../components/Icon.astro";
import BioSectionInteractive from "../components/BioSectionInteractive.astro";
import MyStack from "../components/MyStack.astro";
import ProjectEntry from "../components/work/ProjectEntry.astro";
import { projects } from "../data/projects";

const sortedProjects = [...projects].sort((a, b) => b.order - a.order);

---
<Base 
  title="Theunis Hall — Portfolio" 
  description="Portfolio of Theunis: systems‑led product design with hands‑on UI implementation. Clear, fast, accessible experiences across e‑commerce, fintech, and tools."
>
  <BackgroundStatic opacity={0.3} isLightBg={true} />

  <main class="relative z-10 container-page py-8 md:py-16 lg:py-24 page-blur">
    <!-- Home/Bio Section - This is our reference anchor -->
    <section id="home" class="relative min-h-[90vh] flex flex-col justify-center align-left">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-10 items-start">
        <div>
          <h1 class="h1-display flex items-center gap-2 md:gap-3">Hi, I'm Theunis <Icon name="wave" size={28} class="text-[#500F0B] mt-1 md:w-8 md:h-8" /></h1>
          <div class="mt-4 md:mt-5 max-w-prose">
            <BioSectionInteractive className="h5" />
          </div>
        </div>
        <div class="rounded-2xl md:rounded-3xl overflow-hidden border border-[#EAE2DE] bg-white/60 aspect-[3/4] max-h-[400px] md:max-h-none">
          <img 
            src="/images/profile-01.png" 
            alt="Profile photo of Theunis Hall, looking to the side on a cloudy beach, wearing a black cap and checkered shirt" 
            class="block w-full h-full object-cover"
            width="500"
            height="657"
          />
        </div>
      </div>
      <!-- My Stack pill 40px below the image -->
      <div class="mt-10 lg:-mt-[65px]">
        <MyStack />
      </div>
    </section>

    <!-- Work Section -->
    <section id="work" class="min-h-screen py-16 md:py-24 lg:py-32 align-left" style="font-family: 'PP Mondwest', serif">
      <div class="max-w-7xl">
        <div class="h2-display mb-8 md:mb-16"></div>
        {sortedProjects.map((p) => (<ProjectEntry {...p} />))}
      </div>
    </section>
  </main>
</Base>

<style>
  /* Transition for phone preview images */
  .phone-preview img {
    transition: opacity 0.2s ease-in-out;
  }

  /* Ensure the inline SVG icon fills the 32x32 box and aligns cleanly */
  .project-icon :global(svg) {
    display: block;
    width: 100%;
    height: 100%;
  }

  /* Scale+fade transition for iPhone mockup */
  .iphone-mockup {
    transition: transform 180ms ease, opacity 180ms ease;
    transform-origin: 50% 50%;
    opacity: 1;
  }
  .iphone-mockup.is-out {
    transform: scale(0.985);
    opacity: 0;
  }

  @media (prefers-reduced-motion: reduce) {
    .iphone-mockup { transition: none; }
  }

  /* Global tooltip for Challenge/Solution labels */
  :global(.tip) {
    position: relative;
  }
  :global(.tip::after) {
    content: attr(data-tip);
    position: absolute;
    left: 50%;
    bottom: calc(100% + 8px); /* above the label */
    transform: translateX(-50%);
    display: block;
    box-sizing: border-box;
    background: #FBF9F5;
    color: #000000;
    border: 1px solid #EAE2DE;
    /* Figma shadow spec */
    box-shadow:
      0 8px 16px rgba(0, 0, 0, 0.20),
      0 16px 32px rgba(0, 0, 0, 0.14);
    padding: 8px 10px;
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    font-weight: 400;
    line-height: 1.4;
    border-radius: 12px;
    white-space: normal;
    word-break: normal;
    overflow-wrap: break-word;
    text-align: left;
    width: auto;
    min-width: 300px;
    max-width: 360px;
    height: auto;
    opacity: 0;
    pointer-events: none;
    transition: opacity 120ms ease;
    z-index: 30;
  }
  
  /* On mobile, adjust tooltip positioning to prevent cutoff */
  @media (max-width: 768px) {
    :global(.tip) {
      /* Mobile tooltips will be positioned via JavaScript */
    }
    :global(.tip::after) {
      /* Override defaults for mobile */
      min-width: 280px;
      max-width: calc(100vw - 32px);
    }
  }
  
  :global(.tip:hover::after),
  :global(.tip:focus::after) {
    opacity: 1;
  }

  /* Smooth blur transition for background when modal opens/closes */
  .page-blur {
    transition: filter 180ms ease;
  }
  body.modal-open .page-blur {
    filter: blur(8px);
  }

  /* Hide navigation when modal is open */
  body.modal-open nav {
    opacity: 0;
    pointer-events: none;
    transition: opacity 180ms ease;
  }

  /* Fade the scrim (backdrop) in/out with the modal open state */
  .case-overlay .case-backdrop {
    opacity: 0;
    transition: opacity 360ms ease;
  }
  .case-overlay.is-open .case-backdrop {
    opacity: 1;
  }

  /* Launched tag styles (per Figma spec) */
  .tag-launched {
    display: inline-flex;
    align-items: center;
    padding: 6px 8px 4px; /* top 6px, right 8px, bottom 4px, left 8px */
    background: #F2F7F3; /* fill */
    color: #748716; /* text color */
    border: 2px solid #748716; /* stroke */
    border-radius: 20px; /* updated rounding */
    box-shadow: 0 2px 2px rgba(0, 0, 0, 0.25); /* X:0, Y:2, Blur:2, 25% */
    font-family: 'PP Mondwest', serif; /* match brand type */
    font-size: 16px; /* compact tag size */
    line-height: 1; /* tight line-height for pills */
    white-space: nowrap;
  }
</style>
