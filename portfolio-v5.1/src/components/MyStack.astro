---
export interface Props {
  title?: string;
  className?: string;
}
const { title = "My stack", className = "" } = Astro.props as Props;
---
<div class={`my-stack ${className}`.trim()} aria-label="My stack" role="presentation">
  <span class="stack-label">{title}</span>
  <div class="stack-icons-wrapper">
    <div class="stack-icon icon-1" data-tip="Windsurf"></div>
    <div class="stack-icon icon-2" data-tip="Figma"></div>
    <div class="stack-icon icon-3" data-tip="Play"></div>
    <div class="stack-icon icon-4" data-tip="Blender"></div>
  </div>
</div>

<style>
  .my-stack {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 8px 12px;
    border: 1px solid #A77E75;
    background: transparent;
    color: #500F0B;
    border-radius: 20px;
    user-select: none;
  }

  @media (min-width: 768px) {
    .my-stack {
      gap: 14px;
      padding: 10px 14px;
    }
  }

  .stack-label {
    font-family: 'PP Mondwest', serif;
    font-size: 18px;
    font-weight: 400;
    line-height: 1;
    white-space: nowrap;
  }

  @media (min-width: 768px) {
    .stack-label {
      font-size: 24px;
    }
  }

  .stack-icons-wrapper {
    position: relative;
    height: 36px;
    width: 165px; /* Auto-unfurled on mobile */
    flex-shrink: 0;
    transition: width 240ms ease;
  }

  @media (min-width: 768px) {
    .stack-icons-wrapper {
      height: 44px;
      width: 200px; /* Auto-unfurled on tablet */
    }
  }

  /* Desktop only: start furled and expand on hover */
  @media (min-width: 1024px) {
    .stack-icons-wrapper {
      width: 98px; /* 44px + (3 * 18px overlap) */
    }
    
    .my-stack:hover .stack-icons-wrapper {
      width: 200px;
    }
  }

  .stack-icon {
    position: absolute;
    top: 0;
    width: 36px;
    height: 36px;
    border-radius: 10px;
    background-color: white;
    background-repeat: no-repeat;
    background-position: center;
    background-size: cover;
    border: 1px solid rgba(255, 255, 255, 0.5);
    transition: transform 240ms ease, left 240ms ease;
    cursor: default;
  }

  @media (min-width: 768px) {
    .stack-icon {
      width: 44px;
      height: 44px;
      border-radius: 12px;
    }
  }

  /* Mobile and tablet: auto-unfurled positions (no rotation) */
  .icon-1 {
    left: 0;
    z-index: 4;
    transform: rotate(0deg);
    background-image: url('/images/stack/01-stack-windsurf.svg');
  }

  .icon-2 {
    left: 43px;
    z-index: 3;
    transform: rotate(0deg);
    background-image: url('/images/stack/02-stack-figma.svg');
  }

  .icon-3 {
    left: 86px;
    z-index: 2;
    transform: rotate(0deg);
    background-image: url('/images/stack/03-stack-play.svg');
  }

  .icon-4 {
    left: 129px;
    z-index: 1;
    transform: rotate(0deg);
    background-image: url('/images/stack/04-stack-blender.svg');
  }

  /* Tablet: unfurled positions */
  @media (min-width: 768px) {
    .icon-2 {
      left: 52px;
    }

    .icon-3 {
      left: 104px;
    }

    .icon-4 {
      left: 156px;
    }
  }

  /* Desktop only: start stacked with rotation */
  @media (min-width: 1024px) {
    .icon-1 {
      transform: rotate(-6deg);
    }

    .icon-2 {
      left: 18px;
      transform: rotate(3deg);
    }

    .icon-3 {
      left: 36px;
      transform: rotate(-2deg);
    }

    .icon-4 {
      left: 54px;
      transform: rotate(5deg);
    }
  }

  /* Desktop only: hover to unfurl and straighten */
  @media (min-width: 1024px) {
    .my-stack:hover .icon-1 {
      left: 0;
      transform: rotate(0deg);
      transition-delay: 120ms;
    }

    .my-stack:hover .icon-2 {
      left: 52px;
      transform: rotate(0deg);
      transition-delay: 80ms;
    }

    .my-stack:hover .icon-3 {
      left: 104px;
      transform: rotate(0deg);
      transition-delay: 40ms;
    }

    .my-stack:hover .icon-4 {
      left: 156px;
      transform: rotate(0deg);
      transition-delay: 0ms;
    }
  }

  /* Tooltips */
  .stack-icon::after {
    content: attr(data-tip);
    position: absolute;
    left: 50%;
    bottom: calc(100% + 8px);
    transform: translateX(-50%);
    background: #FBF9F5;
    color: #000000;
    border: 1px solid #EAE2DE;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.20), 0 16px 32px rgba(0, 0, 0, 0.14);
    padding: 8px 10px;
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    font-weight: 400;
    line-height: 1.4;
    border-radius: 12px;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 120ms ease;
    z-index: 30;
  }

  .stack-icon:hover::after {
    opacity: 1;
  }

  /* Respect reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .stack-icon,
    .stack-icons-wrapper {
      transition: none;
    }
  }
</style>
