---
// Navigation.astro - Responsive navigation bar for the portfolio site
// Import NavItem component and SVG files
import NavItem from './NavItem.astro';
import SocialLink from './SocialLink.astro';

// Import SVG files with currentColor support
import HomeIcon from '../icons/home-current.svg?raw';
import WorkIcon from '../icons/work-current.svg?raw';
import ExplorationsIcon from '../icons/explorations-current.svg?raw';
import InstagramIcon from '../icons/instagram.svg?raw';
import TwitterIcon from '../icons/twitter.svg?raw';
import LinkedInIcon from '../icons/linkedin.svg?raw';
import GitHubIcon from '../icons/github.svg?raw';
import ResumeIcon from '../icons/resume.svg?raw';

// Props for the component
export interface Props {
  currentPath: string; // Current path to determine active page
}

const { currentPath = '/' } = Astro.props;

// Define navigation items
const navItems = [
  { name: 'Home', path: '/', icon: HomeIcon },
  { name: 'Work', path: '/#work', icon: WorkIcon },
  { name: 'Explorations', path: '/explorations', icon: ExplorationsIcon }
];

// Define social media links
const socialLinks = [
  { name: 'Instagram', icon: InstagramIcon, url: 'https://www.instagram.com/theunistm/' },
  { name: 'Twitter', icon: TwitterIcon, url: 'https://twitter.com/theunistm' },
  { name: 'LinkedIn', icon: LinkedInIcon, url: 'https://www.linkedin.com/in/theunistm/' },
  { name: 'GitHub', icon: GitHubIcon, url: 'https://github.com/theunistm' }
];

// Get current date for tooltip in DD/MM/YYYY format
const today = new Date();
const formattedDate = `${today.getDate().toString().padStart(2, '0')}/${(today.getMonth() + 1).toString().padStart(2, '0')}/${today.getFullYear()}`;

// Pre-calculate active/inactive color classes
const activeColor = 'fill-[#FBF9F5]';
// Use exactly 50% opacity for inactive state to match the work page
const inactiveColor = 'fill-[#500F0B] opacity-50';
const hoverColor = 'hover:opacity-80';

// Function to check if a nav item is active
const isActive = (itemPath: string) => {
  // Special case for Home and Work since they're on the same page
  if (currentPath === '/' && itemPath === '/') return true;
  if (currentPath === '/#work' && itemPath === '/#work') return true;
  if (currentPath === '/explorations' && itemPath === '/explorations') return true;
  return false;
};
---

<nav class="fixed bottom-8 z-50 left-1/2 transform -translate-x-1/2">
  <!-- Single navbar with two groups -->
  <div class="flex items-center gap-8 rounded-[20px] border border-[#EAE2DE] bg-[#FBF9F5]/50 backdrop-blur-md px-3 py-3">
    <!-- Group 1: Page Navigation -->
    <div class="flex items-center gap-0">
      <NavItem href="/" label="Home" currentPath={currentPath} iconSvg={HomeIcon} />
      <NavItem href="/#work" label="Work" currentPath={currentPath} iconSvg={WorkIcon} />
      <NavItem href="/explorations" label="Explorations" currentPath={currentPath} iconSvg={ExplorationsIcon} />
    </div>

    <!-- Group 2: Meta Info and Social Links -->
    <div class="flex items-center gap-6">
      <!-- Social Media Icons -->
      <div class="flex items-center gap-3">
        <SocialLink href="https://www.instagram.com/theunisthemaker/" label="Instagram" iconSvg={InstagramIcon} />
        <SocialLink href="https://x.com/TheunisTheMaker" label="Twitter" iconSvg={TwitterIcon} />
        <SocialLink href="https://www.linkedin.com/in/theunishall//" label="LinkedIn" iconSvg={LinkedInIcon} />
        <SocialLink href="https://github.com/theunistm" label="GitHub" iconSvg={GitHubIcon} />
      </div>

      <!-- Meta Info -->
      <div class="flex items-center gap-2 text-[18px] text-[#500F0B] font-primary nav-font whitespace-nowrap">
        <span>¬©2025, Theunis Hall</span>
        <span class="opacity-50">‚Ä¢</span>
        <span class="group relative cursor-help">
          <span class="underline">site v5.1</span>
          <span class="absolute bottom-[calc(100%+8px)] left-1/2 -translate-x-1/2 px-[10px] py-[8px] bg-[#FBF9F5] text-[#000000] border border-[#EAE2DE] rounded-[12px] text-[14px] whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity duration-[120ms] pointer-events-none font-sans shadow-[0_8px_16px_rgba(0,0,0,0.20),0_16px_32px_rgba(0,0,0,0.14)] z-30">
            Last updated: {formattedDate} by Theunis üë®‚Äçüíª
          </span>
        </span>
        <span class="opacity-50">‚Ä¢</span>
        
        <!-- Resume Link -->
        <a 
          href="/theunis-hall-product-designer-resume.pdf" 
          target="_blank" 
          rel="noopener noreferrer"
          class="flex items-center gap-2 px-3 py-2 rounded-full transition-all text-[#500F0B] focus-visible:ring-2 focus-visible:ring-[#500F0B] focus-visible:outline-none font-primary nav-font"
          aria-label="Resume"
        >
          <span class="text-[18px] underline">Resume</span>
          <span class="icon w-4 h-4" aria-hidden="true" set:html={ResumeIcon.replace(/fill="black"/g, 'fill="currentColor"')} />
        </a>
      </div>
    </div>
  </div>
</nav>

<script>
  // Script for handling active state on scroll between Home and Work sections
  // and implementing smooth scrolling
  document.addEventListener('DOMContentLoaded', () => {
    const workSection = document.getElementById('work');
    const homeSection = document.getElementById('home');
    const homeLink = document.querySelector('a[href="/"]');
    const workLink = document.querySelector('a[href="/#work"]');
    
    // With our new component structure, we select the icon span that contains the SVG
    const homeIcon = homeLink?.querySelector('.icon');
    const workIcon = workLink?.querySelector('.icon');
    
    // Implement smooth scrolling for Home and Work links
    if (homeLink && workLink) {
      // Home link should scroll to top
      homeLink.addEventListener('click', function(e) {
        // Only intercept if we're already on the homepage
        if (window.location.pathname === '/' || window.location.pathname === '') {
          e.preventDefault();
          window.scrollTo({
            top: 0,
            behavior: 'smooth'
          });
        }
      });
      
      // Work link should scroll to work section
      workLink.addEventListener('click', function(e) {
        // Only intercept if we're already on the homepage
        if (window.location.pathname === '/' || window.location.pathname === '') {
          e.preventDefault();
          const workSectionElement = document.getElementById('work');
          if (workSectionElement) {
            workSectionElement.scrollIntoView({ behavior: 'smooth' });
          }
        }
      });
    }
    
    if (workSection && homeLink && workLink && homeIcon && workIcon) {
      // Function to toggle active/inactive state
      const setNavItemActive = (link, icon, isActive) => {
        if (isActive) {
          // Active state
          link.setAttribute('aria-current', 'page');
          link.classList.add('bg-[#500F0B]');
          link.classList.add('text-[#FBF9F5]');
          link.classList.add('border');
          link.classList.add('border-[#FBF9F5]');
          link.classList.remove('opacity-50');
        } else {
          // Inactive state
          link.removeAttribute('aria-current');
          link.classList.remove('bg-[#500F0B]');
          link.classList.remove('text-[#FBF9F5]');
          link.classList.remove('border');
          link.classList.remove('border-[#FBF9F5]');
          link.classList.add('text-[#500F0B]');
          link.classList.add('opacity-50');
        }
      };
      
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            // Work section is in view
            setNavItemActive(homeLink, homeIcon, false);
            setNavItemActive(workLink, workIcon, true);
          } else {
            // Home section is in view
            setNavItemActive(homeLink, homeIcon, true);
            setNavItemActive(workLink, workIcon, false);
          }
        });
      }, { threshold: 0.2 }); // Trigger when 20% of the element is visible
      
      observer.observe(workSection);

      // Set initial states based on current view
      const initialCheck = new IntersectionObserver((entries) => {
        const isWorkVisible = entries[0].isIntersecting;
        setNavItemActive(homeLink, homeIcon, !isWorkVisible);
        setNavItemActive(workLink, workIcon, isWorkVisible);
        initialCheck.disconnect(); // Only need to check once on page load
      });
      initialCheck.observe(workSection);
    }
  });
</script>
